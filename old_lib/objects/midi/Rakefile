# Generated by mkrf
require 'rake/clean'

CLEAN.include('*.o')
CLOBBER.include('RtMidi.bundle', 'mkrf.log')

SRC = FileList['*.cpp']
OBJ = SRC.ext('o')
CC = 'g++'

ADDITIONAL_OBJECTS = ''

LDSHARED = "cc -dynamic -bundle -undefined suppress -flat_namespace  -L/usr/lib -lgcc -lstdc++ -framework CoreMIDI -framework CoreFoundation -framework CoreAudio"

LIBPATH =  "-L/opt/local/lib "

INCLUDES = "-I/opt/local/include -I/opt/local/lib/ruby/1.8/powerpc-darwin8.7.0 -I/opt/local/lib/ruby/site_ruby/1.8 -I."

LIBS = "-lpthread -ldl -lobjc"

CFLAGS = " -fno-common -O -pipe -I/opt/local/include  -fno-common -pipe -fno-common  -D__MACOSX_CORE__"

RUBYARCHDIR = "#{ENV["RUBYARCHDIR"]}"
LIBRUBYARG_SHARED = "-lruby"

task :default => ['RtMidi.bundle']

rule '.o' => '.cpp' do |t|
  sh "#{CC} #{CFLAGS} #{INCLUDES} -c #{t.source}"
end

desc "Build this extension"
file 'RtMidi.bundle' => OBJ do
  sh "#{LDSHARED} #{LIBPATH} -o RtMidi.bundle #{OBJ} #{ADDITIONAL_OBJECTS} #{LIBS} #{LIBRUBYARG_SHARED}"
end

desc "Install this extension"
task :install => 'RtMidi.bundle' do
  makedirs "#{RUBYARCHDIR}"
  install "RtMidi.bundle", "#{RUBYARCHDIR}"
end


